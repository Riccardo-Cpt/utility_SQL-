-- Script per data lineage su ORACLE SQL
-- INIZIALLIZARE 'OWNER' e 'STARTING NAME' come schema e nome oggetto da cui far partire il lineage

SELECT PATH, LEV FROM (
SELECT
  LEVEL AS LEV
  ,TYPE
  ,REFERENCED_OWNER || '.' || REFERENCED_NAME AS REF_OBJECT
  ,SYS_CONNECT_BY_PATH(REFERENCED_OWNER || '.' || REFERENCED_NAME)
  ,REFERENCED_TYPE
FROM (
  SELECT * 
  FROM DBA_DEPENDENCIES
    WHERE TYPE IN ('MATERIALIZED VIEW', 'VIEW', 'TABLE')
    AND REFERENCED_TYPE || '.' || REFERENCED_OWNER <> AND TYPE || '.' || OWNER
  )
START WITH
OWNER = 'STARTING OWNER'
AND NAME = 'STARTING NAME'
CONNECT BY NOCYCLE
PRIOR REFERENCED_OWNER = OWNER
AND PRIOR NAME = REFERENCED_NAME
ORDER SYBLINGS BY OWNER, NAME, REFERENCED OWNER, REFERENCED_NAME
) WHERE REFERENCED_TYPE IN ('TABLE', 'VIEW')
);
